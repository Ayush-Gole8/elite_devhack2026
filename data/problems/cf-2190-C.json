{
  "title": "Comparable Permutations",
  "slug": "cf-2190-C",
  "difficulty": "Hard",
  "tags": [
    "greedy",
    "implementation",
    "interactive",
    "sortings",
    "two pointers"
  ],
  "time_limit_ms": 2000,
  "memory_limit_kb": 256000,
  "description": "This is an interactive problem.\n\nFor a permutation\nâˆ—\nâˆ—\n \nğ‘”=(\nğ‘”\n1\n,\nğ‘”\n2\n,â€¦,\nğ‘”\nğ‘š\n)\nğ‘”\n=\n(\nğ‘”\n1\n,\nğ‘”\n2\n,\nâ€¦\n,\nğ‘”\nğ‘š\n)\n, define its reverse as \nrev(ğ‘”)=(\nğ‘”\nğ‘š\n,\nğ‘”\nğ‘šâˆ’1\n,â€¦,\nğ‘”\n1\n)\nrev\nâ¡\n(\nğ‘”\n)\n=\n(\nğ‘”\nğ‘š\n,\nğ‘”\nğ‘š\nâˆ’\n1\n,\nâ€¦\n,\nğ‘”\n1\n)\n.\n\nThere is a hidden permutation \nğ‘\nğ‘\n of size \nğ‘›\nğ‘›\n. Your task is to find the lexicographically smallest\nâ€ \nâ€ \n permutation \nğ‘\nğ‘\n of size \nğ‘›\nğ‘›\n such that \nğ‘>ğ‘\nğ‘\n>\nğ‘\n and \nrev(ğ‘)>rev(ğ‘)\nrev\nâ¡\n(\nğ‘\n)\n>\nrev\nâ¡\n(\nğ‘\n)\n.\n\nHowever, you do not need to output \nğ‘\nğ‘\n itself. Instead, you must output a permutation \nğ‘Ÿ\nğ‘Ÿ\n of size \nğ‘›\nğ‘›\n such that \nğ‘\nğ‘–\n=\nğ‘\nğ‘Ÿ\nğ‘–\nğ‘\nğ‘–\n=\nğ‘\nğ‘Ÿ\nğ‘–\n for all \n1â‰¤ğ‘–â‰¤ğ‘›\n1\nâ‰¤\nğ‘–\nâ‰¤\nğ‘›\n. If no such \nğ‘\nğ‘\n exists, report that instead.\n\nTo find the answer, you can ask at most \n3ğ‘›\n3\nğ‘›\n queries of the form \n?Â ğ‘–ğ‘—\n?Â \nğ‘–\nğ‘—\n (\n1â‰¤ğ‘–,ğ‘—â‰¤ğ‘›\n1\nâ‰¤\nğ‘–\n,\nğ‘—\nâ‰¤\nğ‘›\n). The interactor responds with \n1\n1\n if \nğ‘\nğ‘–\n<\nğ‘\nğ‘—\nğ‘\nğ‘–\n<\nğ‘\nğ‘—\n and \n0\n0\n otherwise. The interactor is not adaptive, which means that the permutation \nğ‘\nğ‘\n is fixed throughout the interaction.\n\nâˆ—\nâˆ—\nA permutation of length \nğ‘›\nğ‘›\n is an array consisting of \nğ‘›\nğ‘›\n distinct integers from \n1\n1\n to \nğ‘›\nğ‘›\n in arbitrary order. For example, \n[2,3,1,5,4]\n[\n2\n,\n3\n,\n1\n,\n5\n,\n4\n]\n is a permutation, but \n[1,2,2]\n[\n1\n,\n2\n,\n2\n]\n is not a permutation (\n2\n2\n appears twice in the array), and \n[1,3,4]\n[\n1\n,\n3\n,\n4\n]\n is also not a permutation (\nğ‘›=3\nğ‘›\n=\n3\n but there is \n4\n4\n in the array).\n\nâ€ \nâ€ \n An array \nğ‘¥\nğ‘¥\n is lexicographically smaller than array \nğ‘¦\nğ‘¦\n (so \nğ‘¥<ğ‘¦\nğ‘¥\n<\nğ‘¦\n) if and only if one of the following holds:\n\nğ‘¥\nğ‘¥\n is a prefix of \nğ‘¦\nğ‘¦\n, but \nğ‘¥â‰ ğ‘¦\nğ‘¥\nâ‰ \nğ‘¦\n; or\nLet \nğ‘–\nğ‘–\n be the first position where \nğ‘¥\nğ‘–\nâ‰ \nğ‘¦\nğ‘–\nğ‘¥\nğ‘–\nâ‰ \nğ‘¦\nğ‘–\n (if it exists), then \nğ‘¥\nğ‘–\n<\nğ‘¦\nğ‘–\nğ‘¥\nğ‘–\n<\nğ‘¦\nğ‘–\n.\nInteraction\n\nFor each test case, first read a single integer \nğ‘›\nğ‘›\n.\n\nYou may ask up to \n3ğ‘›\n3\nğ‘›\n queries in each test case.\n\nTo ask a query, print a line in the format \n?ğ‘–ğ‘—\n?\nğ‘–\nğ‘—\n (\n1â‰¤ğ‘–,ğ‘—â‰¤ğ‘›\n1\nâ‰¤\nğ‘–\n,\nğ‘—\nâ‰¤\nğ‘›\n).\n\nAs a response to the query, you will get:\n\n1\n1\n if \nğ‘\nğ‘–\n<\nğ‘\nğ‘—\nğ‘\nğ‘–\n<\nğ‘\nğ‘—\n;\n0\n0\n if \nğ‘\nğ‘–\nâ‰¥\nğ‘\nğ‘—\nğ‘\nğ‘–\nâ‰¥\nğ‘\nğ‘—\n;\nâˆ’1\nâˆ’\n1\n if you made an invalid query or if you exceed the limit of \n3ğ‘›\n3\nğ‘›\n queries.\n\nIf your program makes more than \n3ğ‘›\n3\nğ‘›\n queries for one test case, or makes an invalid query, then the response to the query will be \"-1\". After receiving such a response, your program should immediately terminate to receive the verdict Wrong Answer. Otherwise, it may receive any other verdict.\n\nWhen you determine the answer for the current test case, print one of the following:\n\nIf no valid permutation \nğ‘\nğ‘\n exists, print \n!âˆ’1\n!\nâˆ’\n1\n.\nOtherwise, print \n!\nğ‘Ÿ\n1\nğ‘Ÿ\n2\nâ€¦\nğ‘Ÿ\nğ‘›\n!\nğ‘Ÿ\n1\nğ‘Ÿ\n2\nâ€¦\nğ‘Ÿ\nğ‘›\n, where \nğ‘Ÿ\nğ‘Ÿ\n is a permutation of size \nğ‘›\nğ‘›\n and \nğ‘\nğ‘–\n=\nğ‘\nğ‘Ÿ\nğ‘–\nğ‘\nğ‘–\n=\nğ‘\nğ‘Ÿ\nğ‘–\n.\n\nNote that this output does not count towards the query limit of \n3ğ‘›\n3\nğ‘›\n.\n\nAfter that, proceed to the next test case or terminate your program if there are no more test cases.\n\nAfter printing each query do not forget to output the end of line and flush\nâˆ—\nâˆ—\n the output. Otherwise, you will get Idleness limit exceeded verdict.\n\nIf, at any interaction step, you read \nâˆ’1\nâˆ’\n1\n instead of valid data, your solution must exit immediately. This means that your solution will receive Wrong answer because of an invalid query or any other mistake. Failing to exit can result in an arbitrary verdict because your solution will continue to read from a closed stream.\n\nNote that the interactor is not adaptive, which means that the hidden permutation is unchanged throughout the interaction.\n\nHacks\n\nTo hack, use the following format.\n\nThe first line should contain a single integer \nğ‘¡\nğ‘¡\n (\n1â‰¤ğ‘¡â‰¤1000\n1\nâ‰¤\nğ‘¡\nâ‰¤\n1000\n) â€” the number of test cases.\n\nThe first line of each test case should contain a positive integer \nğ‘›\nğ‘›\n (\n2â‰¤ğ‘›â‰¤2â‹…\n10\n4\n2\nâ‰¤\nğ‘›\nâ‰¤\n2\nâ‹…\n10\n4\n)Â â€” the size of \nğ‘\nğ‘\n.\n\nThe second line of each test case should contain \nğ‘›\nğ‘›\n integers \nğ‘\n1\n,\nğ‘\n2\n,â€¦,\nğ‘\nğ‘›\nğ‘\n1\n,\nğ‘\n2\n,\nâ€¦\n,\nğ‘\nğ‘›\n (\n1â‰¤\nğ‘\nğ‘–\nâ‰¤ğ‘›\n1\nâ‰¤\nğ‘\nğ‘–\nâ‰¤\nğ‘›\n).\n\nYou have to guarantee that given \nğ‘\nğ‘\n is a permutation and that the sum of \nğ‘›\nğ‘›\n over all test cases does not exceed \n2â‹…\n10\n4\n2\nâ‹…\n10\n4\n.\n\nâˆ—\nâˆ—\nTo flush, use:\n\nfflush(stdout) or cout.flush() in C++;\nsys.stdout.flush() in Python;\nsee the documentation for other languages.",
  "input_format": "Input\n\nEach test contains multiple test cases. The first line contains the number of test cases \nğ‘¡\nğ‘¡\n (\n1â‰¤ğ‘¡â‰¤1000\n1\nâ‰¤\nğ‘¡\nâ‰¤\n1000\n). The description of the test cases follows.\n\nThe first line of each test case contains a single integer \nğ‘›\nğ‘›\n (\n2â‰¤ğ‘›â‰¤2â‹…\n10\n4\n2\nâ‰¤\nğ‘›\nâ‰¤\n2\nâ‹…\n10\n4\n)Â â€” the size of the hidden permutation \nğ‘\nğ‘\n.\n\nThe hidden permutation \nğ‘\nğ‘\n is fixed for the test case and does not change during the interaction. In other words, the interactor is not adaptive.\n\nIt is guaranteed that the sum of \nğ‘›\nğ‘›\n over all test cases does not exceed \n2â‹…\n10\n4\n2\nâ‹…\n10\n4\n.",
  "constraints": "Note\n\nIn the example, the interaction proceeds as follows.\n\nSolution\tJury\tExplanation\n\t3\tThere are \n3\n3\n test cases.\n\t5\tIn the first test case, the hidden permutation is \n[5,4,2,3,1]\n[\n5\n,\n4\n,\n2\n,\n3\n,\n1\n]\n, with length \n5\n5\n. The corresponding permutation \nğ‘=[5,4,3,1,2]\nğ‘\n=\n[\n5\n,\n4\n,\n3\n,\n1\n,\n2\n]\n\n? 2 1\t1\tThe solution asks whether \nğ‘\n2\n<\nğ‘\n1\nğ‘\n2\n<\nğ‘\n1\n, and the jury responds with \n1\n1\n, as \n4<5\n4\n<\n5\n.\n! 1 2 4 5 3\t\tThe solution has miraculously determined the answer and prints \nğ‘Ÿ=[1,2,4,5,3]\nğ‘Ÿ\n=\n[\n1\n,\n2\n,\n4\n,\n5\n,\n3\n]\n, because, for instance, \nğ‘\n3\n=\nğ‘\nğ‘Ÿ\n3\n=\nğ‘\n4\n=3\nğ‘\n3\n=\nğ‘\nğ‘Ÿ\n3\n=\nğ‘\n4\n=\n3\n and \nğ‘\n2\n=\nğ‘\nğ‘Ÿ\n2\n=\nğ‘\n2\n=4\nğ‘\n2\n=\nğ‘\nğ‘Ÿ\n2\n=\nğ‘\n2\n=\n4\n.\n\t4\tIn the second test case, the hidden permutation is \n[3,1,2,4]\n[\n3\n,\n1\n,\n2\n,\n4\n]\n, with length \n4\n4\n. The permutation \nğ‘\nğ‘\n does not exist for that case.\n? 2 3\t1\tThe solution asks whether \nğ‘\n2\n<\nğ‘\n3\nğ‘\n2\n<\nğ‘\n3\n, and the jury responds with \n1\n1\n.\n? 1 3\t0\tThe solution asks whether \nğ‘\n1\n<\nğ‘\n3\nğ‘\n1\n<\nğ‘\n3\n, and the jury responds with \n0\n0\n.\n? 1 4\t1\tThe solution asks whether \nğ‘\n1\n<\nğ‘\n4\nğ‘\n1\n<\nğ‘\n4\n, and the jury responds with \n1\n1\n.\n? 2 2\t0\tThe solution asks whether \nğ‘\n2\n<\nğ‘\n2\nğ‘\n2\n<\nğ‘\n2\n, and the jury responds with \n0\n0\n.\n! -1\t\tThe solution now knows that \nğ‘=[3,1,2,4]\nğ‘\n=\n[\n3\n,\n1\n,\n2\n,\n4\n]\n and determines that the corresponding \nğ‘\nğ‘\n does not exist, so it prints \nâˆ’1\nâˆ’\n1\n.\n\t9\tIn the third test case, \nğ‘=[8,1,9,3,5,4,2,6,7]\nğ‘\n=\n[\n8\n,\n1\n,\n9\n,\n3\n,\n5\n,\n4\n,\n2\n,\n6\n,\n7\n]\n, with length \nğ‘›=9\nğ‘›\n=\n9\n.\n!Â 1Â 2Â 3Â 6Â 7Â 4Â 5Â 8Â 9\t\tThe solution decides to guess the answer and outputs \nğ‘Ÿ=[1,2,3,6,7,4,5,8,9]\nğ‘Ÿ\n=\n[\n1\n,\n2\n,\n3\n,\n6\n,\n7\n,\n4\n,\n5\n,\n8\n,\n9\n]\n, which turns out to be correct.\n\nNote that the empty lines in the example input and output are for the sake of clarity and do not occur in the real interaction.",
  "test_cases": [
    {
      "input": "3\n5\n\n1\n\n4\n\n1\n\n0\n\n1\n\n0\n\n9",
      "output": "? 2 1\n\n! 1 2 4 5 3\n\n? 2 3\n\n? 1 3\n\n? 1 4\n\n? 2 2\n\n! -1\n\n! 1 2 3 6 7 4 5 8 9",
      "is_sample": true
    }
  ]
}
