{
  "title": "Median Permutation",
  "slug": "cf-2190-E",
  "difficulty": "Hard",
  "tags": [
    "combinatorics"
  ],
  "time_limit_ms": 2000,
  "memory_limit_kb": 256000,
  "description": "For a permutation âˆ— ğ‘ of size ğ‘š â‰¥ 3 ğ‘š â‰¥ 3, define ğ‘“(ğ‘) ğ‘“ (ğ‘) to be a sequence ğ‘ of size ğ‘š-2 ğ‘š - 2 such that ğ‘ ğ‘– =med(ğ‘ ğ‘–, ğ‘ ğ‘–+1, ğ‘ ğ‘–+2) ğ‘ ğ‘– = med â¡ (ğ‘ ğ‘–, ğ‘ ğ‘– + 1, ğ‘ ğ‘– + 2) for all 1 â‰¤ ğ‘– â‰¤ ğ‘š-2 1 â‰¤ ğ‘– â‰¤ ğ‘š - 2. Here, med(ğ‘¥,ğ‘¦,ğ‘§) med â¡ (ğ‘¥, ğ‘¦, ğ‘§)\n denotes the second smallest element among {ğ‘¥,ğ‘¦,ğ‘§} { ğ‘¥, ğ‘¦, ğ‘§ }. \nYou are given an array ğ‘ of size ğ‘›, where some elements may be 0 \n. It is guaranteed that ğ‘ contains the values 1 and ğ‘› \n (that is, there exist indices ğ‘–,ğ‘— ğ‘–, ğ‘— such that ğ‘ ğ‘– =1 ğ‘ ğ‘– = 1 and ğ‘ ğ‘— =ğ‘› ğ‘ ğ‘— = ğ‘›). \nFind the number of permutations ğ‘ of size ğ‘› satisfying the following conditions: ğ‘ is consistent with ğ‘: for all 1 â‰¤ ğ‘– â‰¤ ğ‘› 1 â‰¤ ğ‘– â‰¤ ğ‘›, if ğ‘ ğ‘– â‰ 0 ğ‘ ğ‘– â‰  0, then ğ‘ ğ‘– = ğ‘ ğ‘– ğ‘ ğ‘– = ğ‘ ğ‘–. All elements of ğ‘“(ğ‘) ğ‘“ (ğ‘) are distinct.\n\nSince the answer can be large, print it modulo 998244353 998 244 353. âˆ— \nA permutation of length ğ‘› \n is an array consisting of ğ‘› \n distinct integers from 1 to ğ‘› in arbitrary order. For example, [2,3,1,5,4] [2, 3, 1, 5, 4] is a permutation, but [1,2,2] [1, 2, 2] is not a permutation (2 \n appears twice in the array), and [1,3,4] [1, 3, 4]\n is also not a permutation (ğ‘›=3 ğ‘› = 3 but there is 4 in the array).",
  "input_format": "Input\n\nEach test contains multiple test cases. The first line contains the number of test cases ğ‘¡ (1 â‰¤ ğ‘¡ â‰¤ 10 4 1 â‰¤ ğ‘¡ â‰¤ 10 4\n). The description of the test cases follows.\n\nThe first line of each test case contains a single integer ğ‘› (3 â‰¤ ğ‘› â‰¤ 2â‹… 10 5 3 â‰¤ ğ‘› â‰¤ 2 â‹… 10 5\n)Â â€” the size of the array.\n\nThe second line contains ğ‘› integers ğ‘ 1, ğ‘ 2,â€¦, ğ‘ ğ‘› ğ‘ 1, ğ‘ 2, â€¦, ğ‘ ğ‘› (0 â‰¤ ğ‘ ğ‘– â‰¤ ğ‘› 0 â‰¤ ğ‘ ğ‘– â‰¤ ğ‘›). \nIt is guaranteed that all non-zero elements of ğ‘ \n are pairwise distinct. It is also guaranteed that ğ‘ contains the values 1 and ğ‘›. \nIt is guaranteed that the sum of ğ‘› \n over all test cases does not exceed 2â‹… 10 5 2 â‹… 10 5.",
  "output_format": "Output\n\nFor each test case, print a single integerÂ â€” the number of permutations ğ‘ \n satisfying the conditions, modulo 998244353 998 244 353\n.",
  "constraints": "Note\n\nIn the first example, the only permutation consistent with the input is ğ‘=[1,3,2] ğ‘ = [1, 3, 2]. We have ğ‘“(ğ‘)=[2] ğ‘“ (ğ‘) = [2], since med(1,3,2)=2 med â¡ (1, 3, 2) = 2. The elements of ğ‘“(ğ‘) ğ‘“ (ğ‘) are distinct, so this permutation is valid. The answer is 1. \nIn the second example, there are two permutations consistent with the input: ğ‘=[3,5,4,1,2] ğ‘ = [3, 5, 4, 1, 2] and ğ‘=[2,5,4,1,3] ğ‘ = [2, 5, 4, 1, 3].\n For ğ‘=[3,5,4,1,2] ğ‘ = [3, 5, 4, 1, 2], ğ‘“(ğ‘)=[4,4,2] ğ‘“ (ğ‘) = [4, 4, 2]. For ğ‘=[2,5,4,1,3] ğ‘ = [2, 5, 4, 1, 3], ğ‘“(ğ‘)=[4,4,3] ğ‘“ (ğ‘) = [4, 4, 3].\nIn both cases, the value 4 appears twice in ğ‘“(ğ‘) ğ‘“ (ğ‘)\n. Thus, there are no valid permutations, and the answer is 0 \n.",
  "test_cases": [
    {
      "input": "5\n3\n1 3 2\n5\n0 5 4 1 0\n7\n0 0 1 0 0 7 0\n10\n1 10 0 0 0 0 0 0 0 0\n15\n0 0 10 0 0 15 0 0 6 7 0 1 0 0 3",
      "output": "1\n0\n10\n1\n4",
      "is_sample": true
    }
  ]
}