{
  "title": "Median Permutation",
  "slug": "cf-2190-E",
  "difficulty": "Hard",
  "tags": [
    "combinatorics"
  ],
  "time_limit_ms": 2000,
  "memory_limit_kb": 256000,
  "description": "For a permutation\nâˆ—\nâˆ—\n ğ‘ of size ğ‘šâ‰¥3, define ğ‘“(ğ‘)\n to be a sequence ğ‘ of size ğ‘šâˆ’2 such that ğ‘ğ‘–=med(ğ‘ğ‘–,ğ‘ğ‘–+1,ğ‘ğ‘–+2)ğ‘ğ‘–=\nmed\nâ¡\n(ğ‘ğ‘–,ğ‘ğ‘–+1,ğ‘ğ‘–+2)\n for all 1â‰¤ğ‘–â‰¤ğ‘šâˆ’2. Here, med(ğ‘¥,ğ‘¦,ğ‘§)\nmed\nâ¡\n(ğ‘¥,ğ‘¦,ğ‘§)\n denotes the second smallest element among {ğ‘¥,ğ‘¦,ğ‘§}\n{\nğ‘¥,ğ‘¦,ğ‘§\n}\n.\n\nYou are given an array ğ‘ of size ğ‘›, where some elements may be 0. It is guaranteed that ğ‘ contains the values 1 and ğ‘› (that is, there exist indices ğ‘–,ğ‘— such that ğ‘ğ‘–=1 and ğ‘ğ‘—=ğ‘›).\n\nFind the number of permutations ğ‘ of size ğ‘› satisfying the following conditions:\n\nğ‘ is consistent with ğ‘\n: for all 1â‰¤ğ‘–â‰¤ğ‘›, if ğ‘ğ‘–â‰ 0 ğ‘ğ‘–â‰ 0, then ğ‘ğ‘–=ğ‘ğ‘–.\nAll elements of ğ‘“(ğ‘)\n are distinct.\n\nSince the answer can be large, print it modulo 998244353.\n\nâˆ—\nâˆ—\nA permutation of length ğ‘› is an array consisting of ğ‘› distinct integers from 1 to ğ‘› in arbitrary order. For example, [2,3,1,5,4]\n[\n2,3,1,5,4\n]\n is a permutation, but [1,2,2]\n[\n1,2,2\n]\n is not a permutation (2 appears twice in the array), and [1,3,4]\n[\n1,3,4\n]\n is also not a permutation (ğ‘›=3 but there is 4 in the array).",
  "input_format": "Each test contains multiple test cases. The first line contains the number of test cases ğ‘¡ (1â‰¤ğ‘¡â‰¤10^4). The description of the test cases follows.\n\nThe first line of each test case contains a single integer ğ‘› (3â‰¤ğ‘›â‰¤2â‹…10^5)Â â€” the size of the array.\n\nThe second line contains ğ‘› integers ğ‘1,ğ‘2,â€¦,ğ‘ğ‘› (0â‰¤ğ‘ğ‘–â‰¤ğ‘›).\n\nIt is guaranteed that all non-zero elements of ğ‘ are pairwise distinct. It is also guaranteed that ğ‘ contains the values 1 and ğ‘›.\n\nIt is guaranteed that the sum of ğ‘› over all test cases does not exceed 2â‹…10^5.",
  "output_format": "For each test case, print a single integerÂ â€” the number of permutations ğ‘ satisfying the conditions, modulo 998244353.",
  "constraints": "In the first example, the only permutation consistent with the input is ğ‘=[1,3,2]\nğ‘=\n[\n1,3,2\n]\n. We have ğ‘“(ğ‘)=[2]\nğ‘“(ğ‘)\n=\n[\n2\n]\n, since med(1,3,2)=2\nmed\nâ¡\n(1,3,2)\n=2. The elements of ğ‘“(ğ‘)\n are distinct, so this permutation is valid. The answer is 1.\n\nIn the second example, there are two permutations consistent with the input: ğ‘=[3,5,4,1,2]\nğ‘=\n[\n3,5,4,1,2\n]\n and ğ‘=[2,5,4,1,3]\nğ‘=\n[\n2,5,4,1,3\n]\n.\n\nFor ğ‘=[3,5,4,1,2]\nğ‘=\n[\n3,5,4,1,2\n]\n, ğ‘“(ğ‘)=[4,4,2]\nğ‘“(ğ‘)\n=\n[\n4,4,2\n]\n.\nFor ğ‘=[2,5,4,1,3]\nğ‘=\n[\n2,5,4,1,3\n]\n, ğ‘“(ğ‘)=[4,4,3]\nğ‘“(ğ‘)\n=\n[\n4,4,3\n]\n.\nIn both cases, the value 4 appears twice in ğ‘“(ğ‘)\n. Thus, there are no valid permutations, and the answer is 0.",
  "test_cases": [
    {
      "input": "5\n3\n1 3 2\n5\n0 5 4 1 0\n7\n0 0 1 0 0 7 0\n10\n1 10 0 0 0 0 0 0 0 0\n15\n0 0 10 0 0 15 0 0 6 7 0 1 0 0 3",
      "output": "1\n0\n10\n1\n4",
      "is_sample": true
    }
  ],
  "patterns": [
    "backtracking",
    "dp"
  ]
}