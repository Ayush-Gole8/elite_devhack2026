{
  "title": "Median Permutation",
  "slug": "cf-2190-E",
  "difficulty": "Hard",
  "tags": [
    "combinatorics"
  ],
  "time_limit_ms": 2000,
  "memory_limit_kb": 256000,
  "description": "For a permutation\nâˆ—\nâˆ—\n \nğ‘\nğ‘\n of size \nğ‘šâ‰¥3\nğ‘š\nâ‰¥\n3\n, define \nğ‘“(ğ‘)\nğ‘“\n(\nğ‘\n)\n to be a sequence \nğ‘\nğ‘\n of size \nğ‘šâˆ’2\nğ‘š\nâˆ’\n2\n such that \nğ‘\nğ‘–\n=med(\nğ‘\nğ‘–\n,\nğ‘\nğ‘–+1\n,\nğ‘\nğ‘–+2\n)\nğ‘\nğ‘–\n=\nmed\nâ¡\n(\nğ‘\nğ‘–\n,\nğ‘\nğ‘–\n+\n1\n,\nğ‘\nğ‘–\n+\n2\n)\n for all \n1â‰¤ğ‘–â‰¤ğ‘šâˆ’2\n1\nâ‰¤\nğ‘–\nâ‰¤\nğ‘š\nâˆ’\n2\n. Here, \nmed(ğ‘¥,ğ‘¦,ğ‘§)\nmed\nâ¡\n(\nğ‘¥\n,\nğ‘¦\n,\nğ‘§\n)\n denotes the second smallest element among \n{ğ‘¥,ğ‘¦,ğ‘§}\n{\nğ‘¥\n,\nğ‘¦\n,\nğ‘§\n}\n.\n\nYou are given an array \nğ‘\nğ‘\n of size \nğ‘›\nğ‘›\n, where some elements may be \n0\n0\n. It is guaranteed that \nğ‘\nğ‘\n contains the values \n1\n1\n and \nğ‘›\nğ‘›\n (that is, there exist indices \nğ‘–,ğ‘—\nğ‘–\n,\nğ‘—\n such that \nğ‘\nğ‘–\n=1\nğ‘\nğ‘–\n=\n1\n and \nğ‘\nğ‘—\n=ğ‘›\nğ‘\nğ‘—\n=\nğ‘›\n).\n\nFind the number of permutations \nğ‘\nğ‘\n of size \nğ‘›\nğ‘›\n satisfying the following conditions:\n\nğ‘\nğ‘\n is consistent with \nğ‘\nğ‘\n: for all \n1â‰¤ğ‘–â‰¤ğ‘›\n1\nâ‰¤\nğ‘–\nâ‰¤\nğ‘›\n, if \nğ‘\nğ‘–\nâ‰ 0\nğ‘\nğ‘–\nâ‰ \n0\n, then \nğ‘\nğ‘–\n=\nğ‘\nğ‘–\nğ‘\nğ‘–\n=\nğ‘\nğ‘–\n.\nAll elements of \nğ‘“(ğ‘)\nğ‘“\n(\nğ‘\n)\n are distinct.\n\nSince the answer can be large, print it modulo \n998244353\n998\n244\n353\n.\n\nâˆ—\nâˆ—\nA permutation of length \nğ‘›\nğ‘›\n is an array consisting of \nğ‘›\nğ‘›\n distinct integers from \n1\n1\n to \nğ‘›\nğ‘›\n in arbitrary order. For example, \n[2,3,1,5,4]\n[\n2\n,\n3\n,\n1\n,\n5\n,\n4\n]\n is a permutation, but \n[1,2,2]\n[\n1\n,\n2\n,\n2\n]\n is not a permutation (\n2\n2\n appears twice in the array), and \n[1,3,4]\n[\n1\n,\n3\n,\n4\n]\n is also not a permutation (\nğ‘›=3\nğ‘›\n=\n3\n but there is \n4\n4\n in the array).",
  "input_format": "Input\n\nEach test contains multiple test cases. The first line contains the number of test cases \nğ‘¡\nğ‘¡\n (\n1â‰¤ğ‘¡â‰¤\n10\n4\n1\nâ‰¤\nğ‘¡\nâ‰¤\n10\n4\n). The description of the test cases follows.\n\nThe first line of each test case contains a single integer \nğ‘›\nğ‘›\n (\n3â‰¤ğ‘›â‰¤2â‹…\n10\n5\n3\nâ‰¤\nğ‘›\nâ‰¤\n2\nâ‹…\n10\n5\n)Â â€” the size of the array.\n\nThe second line contains \nğ‘›\nğ‘›\n integers \nğ‘\n1\n,\nğ‘\n2\n,â€¦,\nğ‘\nğ‘›\nğ‘\n1\n,\nğ‘\n2\n,\nâ€¦\n,\nğ‘\nğ‘›\n (\n0â‰¤\nğ‘\nğ‘–\nâ‰¤ğ‘›\n0\nâ‰¤\nğ‘\nğ‘–\nâ‰¤\nğ‘›\n).\n\nIt is guaranteed that all non-zero elements of \nğ‘\nğ‘\n are pairwise distinct. It is also guaranteed that \nğ‘\nğ‘\n contains the values \n1\n1\n and \nğ‘›\nğ‘›\n.\n\nIt is guaranteed that the sum of \nğ‘›\nğ‘›\n over all test cases does not exceed \n2â‹…\n10\n5\n2\nâ‹…\n10\n5\n.",
  "output_format": "Output\n\nFor each test case, print a single integerÂ â€” the number of permutations \nğ‘\nğ‘\n satisfying the conditions, modulo \n998244353\n998\n244\n353\n.",
  "constraints": "Note\n\nIn the first example, the only permutation consistent with the input is \nğ‘=[1,3,2]\nğ‘\n=\n[\n1\n,\n3\n,\n2\n]\n. We have \nğ‘“(ğ‘)=[2]\nğ‘“\n(\nğ‘\n)\n=\n[\n2\n]\n, since \nmed(1,3,2)=2\nmed\nâ¡\n(\n1\n,\n3\n,\n2\n)\n=\n2\n. The elements of \nğ‘“(ğ‘)\nğ‘“\n(\nğ‘\n)\n are distinct, so this permutation is valid. The answer is \n1\n1\n.\n\nIn the second example, there are two permutations consistent with the input: \nğ‘=[3,5,4,1,2]\nğ‘\n=\n[\n3\n,\n5\n,\n4\n,\n1\n,\n2\n]\n and \nğ‘=[2,5,4,1,3]\nğ‘\n=\n[\n2\n,\n5\n,\n4\n,\n1\n,\n3\n]\n.\n\nFor \nğ‘=[3,5,4,1,2]\nğ‘\n=\n[\n3\n,\n5\n,\n4\n,\n1\n,\n2\n]\n, \nğ‘“(ğ‘)=[4,4,2]\nğ‘“\n(\nğ‘\n)\n=\n[\n4\n,\n4\n,\n2\n]\n.\nFor \nğ‘=[2,5,4,1,3]\nğ‘\n=\n[\n2\n,\n5\n,\n4\n,\n1\n,\n3\n]\n, \nğ‘“(ğ‘)=[4,4,3]\nğ‘“\n(\nğ‘\n)\n=\n[\n4\n,\n4\n,\n3\n]\n.\nIn both cases, the value \n4\n4\n appears twice in \nğ‘“(ğ‘)\nğ‘“\n(\nğ‘\n)\n. Thus, there are no valid permutations, and the answer is \n0\n0\n.",
  "test_cases": [
    {
      "input": "5\n3\n1 3 2\n5\n0 5 4 1 0\n7\n0 0 1 0 0 7 0\n10\n1 10 0 0 0 0 0 0 0 0\n15\n0 0 10 0 0 15 0 0 6 7 0 1 0 0 3",
      "output": "1\n0\n10\n1\n4",
      "is_sample": true
    }
  ]
}
