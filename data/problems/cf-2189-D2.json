{
  "title": "Little String (Hard Version)",
  "slug": "cf-2189-D2",
  "difficulty": "Hard",
  "tags": [
    "combinatorics",
    "dp",
    "greedy",
    "math",
    "number theory"
  ],
  "time_limit_ms": 2000,
  "memory_limit_kb": 256000,
  "description": "This is the hard version of the problem. The difference between the versions is that in this version, the string ğ‘  \n can contain the character ?.\n For the string ğ‘¤ 1 ğ‘¤ 2 â€¦ ğ‘¤ ğ‘› ğ‘¤ 1 ğ‘¤ 2 â€¦ ğ‘¤ ğ‘›, consisting of characters 0 and 1, we define ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤) as the number of permutations ğ‘ 1, ğ‘ 2,â€¦, ğ‘ ğ‘› ğ‘ 1, ğ‘ 2, â€¦, ğ‘ ğ‘› of the array [0,1,â€¦,ğ‘›-1] [0, 1, â€¦, ğ‘› - 1], such that for all ğ‘– from 1 to ğ‘› the following holds: if ğ‘¤ ğ‘– =ğŸ· ğ‘¤ ğ‘– = 1, then there exist such 1 â‰¤ ğ‘™ â‰¤ ğ‘Ÿ â‰¤ ğ‘› 1 â‰¤ ğ‘™ â‰¤ ğ‘Ÿ â‰¤ ğ‘› that mex([ğ‘ ğ‘™, ğ‘ ğ‘™+1,â€¦, ğ‘ ğ‘Ÿ])=ğ‘– mex â¡ ([ğ‘ ğ‘™, ğ‘ ğ‘™ + 1, â€¦, ğ‘ ğ‘Ÿ]) = ğ‘– ; âˆ— if ğ‘¤ ğ‘– =ğŸ¶ ğ‘¤ ğ‘– = 0\n, then there do not exist such 1 â‰¤ ğ‘™ â‰¤ ğ‘Ÿ â‰¤ ğ‘› 1 â‰¤ ğ‘™ â‰¤ ğ‘Ÿ â‰¤ ğ‘› that mex([ğ‘ ğ‘™, ğ‘ ğ‘™+1,â€¦, ğ‘ ğ‘Ÿ])=ğ‘– mex â¡ ([ğ‘ ğ‘™, ğ‘ ğ‘™ + 1, â€¦, ğ‘ ğ‘Ÿ]) = ğ‘–.\n Given a string ğ‘  1 ğ‘  2 â€¦ ğ‘  ğ‘› ğ‘  1 ğ‘  2 â€¦ ğ‘  ğ‘›, consisting of characters 0, 1, and ?, and a positive integer ğ‘ \n. Consider all strings ğ‘¤ \n that can be obtained from ğ‘  \n by replacing all characters ? with characters 0 and 1. Find the smallest value of ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤) among all such strings ğ‘¤ \n that is not divisible by ğ‘ \n, or determine that such a string ğ‘¤ \n does not exist. Since the answer may be large, find it modulo 10 9 +7 10 9 + 7. âˆ— The minimum excluded (MEX) of a collection of integers ğ‘ 1, ğ‘ 2,â€¦, ğ‘ ğ‘˜ ğ‘ 1, ğ‘ 2, â€¦, ğ‘ ğ‘˜\n is defined as the smallest non-negative integer ğ‘¥ \n which does not occur in the collection ğ‘ \n.",
  "input_format": "Input\n\nEach test contains multiple test cases. The first line contains the number of test cases ğ‘¡ (1 â‰¤ ğ‘¡ â‰¤ 10 4 1 â‰¤ ğ‘¡ â‰¤ 10 4\n). The description of the test cases follows.\n\nThe first line of each test case contains two integers ğ‘› and ğ‘ (3 â‰¤ ğ‘› â‰¤ 2â‹… 10 5 3 â‰¤ ğ‘› â‰¤ 2 â‹… 10 5, 1 â‰¤ ğ‘ â‰¤ 10 9 1 â‰¤ ğ‘ â‰¤ 10 9)Â â€” the length of the string and the number that limits the value of the function.\n\nThe second line of each test case contains a string of length ğ‘› \n, consisting of characters 0, 1, and ?Â â€” the string ğ‘ . \nIt is guaranteed that the sum of ğ‘› \n across all test cases does not exceed 2â‹… 10 5 2 â‹… 10 5.",
  "output_format": "Output\n\nFor each test case, if there exists such a string ğ‘¤ \n that can be obtained from ğ‘  \n by replacing all characters ? with characters 0 and 1, such that ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤) is not divisible by ğ‘ \n, then output the minimum value of ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤) among all such strings ğ‘¤ \n. The answer should be output modulo 10 9 +7 10 9 + 7. If such a string does not exist, output -1 - 1.",
  "constraints": "Note\n\nIn the second test case, there is no suitable string ğ‘¤, since ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤)\n is always divisible by 1. \nIn the third test case, we can only take ğ‘¤=ğ‘  ğ‘¤ = ğ‘ , then ğ‘“(ğ‘¤)=4 ğ‘“ (ğ‘¤) = 4\n, as there are exactly 4 suitable permutations: ğ‘=[0,2,3,1] ğ‘ = [0, 2, 3, 1] ; ğ‘=[0,3,2,1] ğ‘ = [0, 3, 2, 1] ; ğ‘=[1,2,3,0] ğ‘ = [1, 2, 3, 0] ; ğ‘=[1,3,2,0] ğ‘ = [1, 3, 2, 0].\n\nIn the seventh test case, one can take the string ğ‘¤=ğŸ·ğŸ¶ğŸ¶ğŸ¶ğŸ· ğ‘¤ = 10001, then ğ‘“(ğ‘¤) ğ‘“ (ğ‘¤) will be equal to 12. One of the suitable permutations is [0,4,3,2,1] [0, 4, 3, 2, 1]\n, while, for example, the permutation [0,1,2,3,4] [0, 1, 2, 3, 4]\n does not fit. It can be shown that 12 \n is the smallest value not divisible by 8 \n that can be obtained.",
  "test_cases": [
    {
      "input": "10\n3 3\n00?\n3 1\n???\n4 100\n1001\n3 3\n???\n6 100\n111001\n6 100\n111101\n5 8\n100?1\n4 100\n1??0\n20 253034496\n10001100011000??????\n3 4\n1?1",
      "output": "-1\n-1\n4\n2\n96\n64\n12\n-1\n833286105\n2",
      "is_sample": true
    }
  ]
}